{% extends "base.html" %}
{% block content %}
<p>トーク一覧</p>

{% for talk in my_talks %}
<div>
    {% if talk.sending_user == user %}
    {% if talk.exist_reply == True %}
    <a href="{% url 'postapp:talk_detail' talk_id=talk.id %}">
        <!-- トークの相手の名前を表示 -->
        {{talk.receiving_user}}
    </a>
    {% else %}
    <a>
        <!-- トークの相手の名前を表示するが返信不可 -->
        {{talk.receiving_user}}:返信待ち
    </a>
    {% endif %}
    {% else %}
    <a href="{% url 'postapp:talk_detail' talk_id=talk.id %}">
        <!-- 相手からの送信なので名前を表示 -->
        {{talk.sending_user}}
    </a>
    {% endif %}
    <span> : {{talk.created_at}}</span>
</div>
{% endfor %}


<div id="all-talks">
</div>


<script>
    const data = JSON.parse('{{ data_json|safe }}');

<<<<<<< HEAD
    function aaa(){
        let nowTime = new Date();
        let limit_date = new Date(days=14)
        const data = JSON.parse('{{ data_json|safe }}');
        for (let d in data){

=======
    function init_display() {
        for (let d in data) {
>>>>>>> 7daad8d1a7f69c330556326a8c9690da43b3e4b9
            var newElement = document.createElement("p"); // p要素作成
            newElement.setAttribute("id", "talk" + d); // p要素にidを設定

            var parentDiv = document.getElementById("all-talks");
            parentDiv.insertBefore(newElement, parentDiv.firstChild);
        }
    }
<<<<<<< HEAD
    
    function clock2() {
=======

    function update_time() {
>>>>>>> 7daad8d1a7f69c330556326a8c9690da43b3e4b9
        let nowTime = new Date();
        let limit_date = new Date(days = 14)
        for (let d in data) {
            let created_at = new Date(data[d])
            created_at.setDate(created_at.getDate() + 14);
            let left_time = (created_at - nowTime) / 1000

            let daysLeft = Math.floor(left_time / (24 * 60 * 60));
            let hoursLeft = (Math.floor(left_time / (60 * 60))) % 24;
            let minitesLeft = (Math.floor(left_time / 60)) % 60;
            let secondsLeft = Math.floor(left_time) % 60;
            // 二桁表示
            minitesLeft = ("0" + minitesLeft).slice(-2)
            secondsLeft = ("0" + secondsLeft).slice(-2)
            // 出力
            document.querySelector("#talk" + d).innerHTML = ("残り時間は" + daysLeft + "日" + hoursLeft + "時間" + minitesLeft + "分" + secondsLeft + "秒です");
        }
    }
    init_display();
    update_time();

    setInterval(update_time, 1000)

</script>

{% endblock %}